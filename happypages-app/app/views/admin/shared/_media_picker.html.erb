<%# locals: (field_name:, context:, current_value:) %>
<div data-controller="media-picker" data-media-picker-context-value="<%= context %>" data-media-picker-current-value="<%= current_value %>">
  <label class="block text-sm font-medium text-gray-700 mb-1">Banner Image</label>

  <%# Hidden field that carries the selected URL into the form %>
  <input
    type="hidden"
    name="<%= field_name %>"
    value="<%= current_value %>"
    data-media-picker-target="hiddenField"
    <% if context == "referral" %>
      data-referral-preview-target="bannerImage"
      data-action="input->referral-preview#updatePreview input->referral-page-save#checkForChanges"
    <% else %>
      data-preview-target="bannerImage"
      data-action="input->preview#updatePreview"
    <% end %>
  >

  <%# Compact upload zone %>
  <div
    data-media-picker-target="dropzone"
    data-action="dragover->media-picker#dragOver dragenter->media-picker#dragEnter dragleave->media-picker#dragLeave drop->media-picker#drop click->media-picker#openFilePicker"
    class="relative mb-3 border border-dashed border-black/15 rounded-lg px-4 py-3 text-center cursor-pointer transition-colors hover:border-[#ff584d]/40 hover:bg-[#ff584d]/5"
  >
    <input
      type="file"
      accept="image/jpeg,image/png,image/webp,image/gif"
      data-media-picker-target="fileInput"
      data-action="change->media-picker#handleFileSelect"
      class="hidden"
    >
    <p class="text-xs text-gray-500">Drop image or <span class="text-[#ff584d] font-medium">browse</span></p>

    <%# Upload progress %>
    <div data-media-picker-target="progress" class="hidden mt-2">
      <div class="w-32 mx-auto bg-gray-200 rounded-full h-1">
        <div data-media-picker-target="progressBar" class="bg-[#ff584d] h-1 rounded-full transition-all duration-200" style="width: 0%"></div>
      </div>
    </div>
  </div>

  <%# Error %>
  <div data-media-picker-target="error" class="hidden mb-2 px-3 py-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-700"></div>

  <%# Thumbnail grid %>
  <div
    data-media-picker-target="grid"
    class="grid grid-cols-4 gap-2 mb-3 max-h-40 overflow-y-auto"
  ></div>

  <%# URL fallback toggle %>
  <button type="button" data-action="click->media-picker#toggleUrl" data-media-picker-target="urlToggle" class="text-xs text-gray-400 hover:text-gray-600 transition-colors">
    Or enter URL manually &darr;
  </button>
  <div data-media-picker-target="urlSection" class="hidden mt-2">
    <input
      type="url"
      data-media-picker-target="urlInput"
      data-action="input->media-picker#urlChanged"
      class="w-full px-3 py-1.5 text-sm bg-[#f9f9f9] border border-black/10 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff584d] focus:border-[#ff584d]"
      placeholder="https://..."
      value="<%= current_value&.start_with?('http') && !current_value&.include?('/rails/active_storage/') ? current_value : '' %>"
    >
  </div>
</div>
