<%# Search by referral code %>
<div class="mb-6">
  <%= form_with url: superadmin_shop_path(@shop), method: :get, class: "flex gap-3 items-end", data: { turbo_frame: "_top" } do %>
    <div class="flex-1 max-w-xs">
      <label for="code" class="block text-sm font-medium text-gray-700 mb-1">Search by code</label>
      <input type="text" name="code" id="code" value="<%= params[:code] %>" placeholder="e.g. Sarah042"
        class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-slate-900/20 focus:border-slate-900">
    </div>
    <button type="submit" class="px-4 py-2 bg-slate-900 text-white rounded-lg text-sm font-medium hover:bg-slate-800 transition-colors">
      Search
    </button>
    <% if params[:code].present? %>
      <%= link_to "Clear", superadmin_shop_path(@shop), class: "px-4 py-2 text-gray-600 text-sm hover:text-gray-900 transition-colors" %>
    <% end %>
  <% end %>
</div>

<div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Code</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">First Name</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Usages</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Rewards</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Created</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-100">
      <% @referrals.each do |referral| %>
        <tr>
          <td class="px-6 py-3 text-sm font-mono text-gray-900"><%= referral.referral_code %></td>
          <td class="px-6 py-3 text-sm text-gray-600"><%= referral.first_name %></td>
          <td class="px-6 py-3 text-sm text-gray-900 tabular-nums"><%= referral.usage_count || 0 %></td>
          <td class="px-6 py-3 text-sm text-gray-900 tabular-nums"><%= referral.referral_rewards.size %></td>
          <td class="px-6 py-3 text-sm text-gray-500"><%= referral.created_at.strftime("%b %d, %Y") %></td>
        </tr>
      <% end %>

      <% if @referrals.empty? %>
        <tr>
          <td colspan="5" class="px-6 py-8 text-center text-gray-400 text-sm">
            <%= params[:code].present? ? "No referrals matching \"#{params[:code]}\"" : "No referrals yet" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
