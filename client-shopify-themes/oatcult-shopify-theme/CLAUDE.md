# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

This is a Shopify theme for Oat Cult, based on the "Impact" theme (v6.0.1) by Maestrooo. It's a Shopify Online Store 2.0 theme using JSON templates and Liquid.

## Commands

```bash
# Local development with Shopify CLI
shopify theme dev --store=oatcult.myshopify.com

# Push theme to Shopify
shopify theme push

# Pull latest from Shopify
shopify theme pull
```

No build step required - Liquid templates are rendered server-side by Shopify.

## Architecture

### Directory Structure

- `layout/` - Base layouts (`theme.liquid` is the main layout)
- `sections/` - Reusable content sections (70+ sections available)
- `snippets/` - Partial templates rendered via `{% render %}`
- `templates/` - JSON template files that compose sections
- `config/` - Theme settings (`settings_schema.json` defines options, `settings_data.json` stores values)
- `assets/` - Static files (CSS, JS, fonts, images)
- `locales/` - Translation files (30+ languages)

### Key Files

- `layout/theme.liquid` - Main HTML shell, loads all CSS/JS
- `snippets/css-variables.liquid` - Theme-wide CSS custom properties
- `snippets/js-variables.liquid` - JavaScript configuration
- `assets/theme.js` - Main JavaScript (uses ES modules with importmap)
- `assets/theme.css` - Main stylesheet

### Template System

Templates are JSON files that define which sections appear on each page type:
- `templates/index.json` - Homepage
- `templates/product.json` - Product pages
- `templates/collection.json` - Collection pages
- `templates/page.*.json` - Custom page templates

### Third-Party Integrations

- **Beae Page Builder** - Custom snippets (`beae_header`, `beae_footer`, `beae_ab_snippet`)
- **Alpine.js** - Loaded via CDN for reactive components
- **Animate.css** - CSS animation library
- **Okendo Reviews** - Product ratings integration

## Customization Patterns

### Section Settings

Each section has a `{% schema %}` block at the bottom defining its settings. These appear in the Shopify theme editor.

### Custom CSS per Section

Sections support `custom_css` in their settings, injected as scoped styles.

### CSS Variables

Global design tokens are defined in `snippets/css-variables.liquid`:
- Spacing scale (`--spacing-1` through `--spacing-96`)
- Container widths (`--container-max-width`)
- Typography settings
- Color values from theme settings

## Gotchas

- JSON template files are auto-generated by Shopify's theme editor - manual edits may be overwritten
- The theme uses CSS importmap polyfill for older Safari versions
- Beae page builder snippets are injected into `theme.liquid` - don't remove these comments
- Custom fonts (Rudolph, Apercu) are loaded externally
- Product handle matching (e.g., checking for "cacao" in handle) is fragile - handles may vary (cacao vs cocoa). Use block-level settings instead.
- Liquid variables persist across the template - a `{% assign %}` inside a `<script>` tag is still available later in the same file

## Shop Purchase Flow Architecture

The `sections/shop-purchase-flow.liquid` section uses a unified block system:

- **Block type:** `flavor_option` - used for both bundles (mixed box) and individual flavors
- **Key settings:**
  - `is_bundle` - marks the option as mutually exclusive (selecting it deselects others)
  - `card_background` - full-bleed background image (set per block, not per handle)
  - `card_image` - product image for the card
  - `subtitle` - text below name (e.g., "All 3" for mixed box)
- **JavaScript state:**
  - `selectedBundle` - product ID of selected bundle (or null)
  - `selectedFlavors` - array of individual flavor IDs
  - `bundleProductIds` - populated from blocks with `is_bundle: true`
- **Selection logic:** Selecting a bundle clears individual selections and vice versa

## Project Learnings

See [LEARNINGS.md](./LEARNINGS.md) for detailed gotchas and session discoveries.

## Rules

- NEVER run Shopify CLI commands (`shopify theme dev`, `shopify theme push`, `shopify theme pull`, etc.) without explicit permission EVERY TIME - these commands interact with live store data

## Planning Docs

- [SPEC.md](./SPEC.md) - Project specification and feature checklist
- [SHOP-PURCHASE-FLOW-SPEC.md](./SHOP-PURCHASE-FLOW-SPEC.md) - Shop purchase flow design spec (authoritative)
- [SUBSCRIPTION-MIGRATION-PLAN.md](./SUBSCRIPTION-MIGRATION-PLAN.md) - Subscription app migration analysis
- [PRODUCT-PAGE-CRO-PLAN.md](./PRODUCT-PAGE-CRO-PLAN.md) - Product page redesign spec (superseded by SHOP-PURCHASE-FLOW-SPEC.md)
- [CRO-AUDIT-CLIENT.md](./CRO-AUDIT-CLIENT.md) - Client-facing CRO audit

## Documentation

Official technical documentation: https://support.maestrooo.com/category/300-technical-documentation
